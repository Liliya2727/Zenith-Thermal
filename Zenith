#!/system/bin/sh
apply() {
    [ -f "$2" ] && {
        chmod 644 "$2"
        echo "$1" > "$2"
        chmod 444 "$2"
    }
}

thermalsvc() {
    find /system/etc/init /vendor/etc/init /odm/etc/init -type f 2>/dev/null \
        | xargs grep -h "^service" | awk '{print $2}' | grep thermal
}

# Stop all thermal services
for svc in $(thermalsvc); do
    stop "$svc"
done

# Clear init.svc_ properties only if they exist
getprop | awk -F '[][]' '/init\.svc_/ {print $2}' | while read -r initprop; do
    [ -n "$initprop" ] && resetprop -n "$initprop" ""
done

# Stop Thermal Service
for thermalsvcmtk in android.hardware.thermal-service.mediatek android.hardware.thermal@2.0-service.mtk; do
    stop "$thermalsvcmtk"
    pidof "$thermalsvcmtk" | xargs -r kill -SIGSTOP
done

# Update thermal-related properties
getprop | grep thermal | awk -F '[][]' '{print $2}' | grep -E "init.svc.|init.svc_" | while read -r prop; do
    case $prop in
        init.svc.*) setprop "$prop" stopped ;;
        init.svc_*) resetprop -n "$prop" "" ;;
    esac
done

# Freeze running thermal processes
for thermalprocess in $(pgrep thermal); do
    kill -SIGSTOP "$thermalprocess"
done

# Disable thermal zones policy
for thermalzone in /sys/class/thermal/thermal_zone*/{mode,policy}; do
    [ -f "$thermalzone" ] && echo "${thermalzone##*/}" | sed 's/mode/disabled/;s/policy/userspace/' > "$thermalzone"
done

# Disable thermal zones
for thermalzone in /sys/class/thermal/thermal_zone*/{mode,policy}; do
    [ -f "$thermalzone" ] && echo "${thermalzone##*/}" | sed 's/mode/disabled/;s/policy/userspace/' > "$thermalzone"
done

# Hide thermal monitoring by making files inaccessible
find /sys/devices/virtual/thermal -type f -exec chmod 000 {} \;

# Disable thermal stats
cmd thermalservice override-status 0

# Spoof Battery Temperature 
apply "20" "/sys/class/power_supply/battery/temperature"

# Disable Battery Current Limiter
apply "stop 1" "/proc/mtk_batoc_throttling/battery_oc_protect_stop"